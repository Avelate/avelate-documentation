# Завантажувачі схем

Завантажувачі схем призначені для створення результуючих, абстрактних схем даних. В послідуючому ці схеми даних оброблються відповідним адаптером, перетворюючи абстрактну схему даних в конкретний тип схеми, яка відповідає контрактах конкретної технології. Завдяки абстракції в вигляді завантажувача схем `schema loaders` конкретний функціонал ядра серверної платформи може не залежити від конкретної бібліотеки.

Типи завантажувачів схем та їх призначення:

| Назва | Опис |
| :---: | :--- |
| Завантажувач бізнес-логіки `BusinessLoader` | Створює результуючу схему функціоналу всієї бізнес-логіки серверного застосунку |
| Завантажувач `Swagger` документації `SwaggerLoader` | Створює результуючу схему REST API документації для послідуючої генерації `OpenAPI` (`SwaggerAPI`) документації |
| Завантажувач `AsyncApi` документації `AsyncApiLoader` | Створює результуючу схему Websocket events документації для послідуючої генерації `AsyncApi` документації |

Кожний завантажувач передбачає створення колекції `Map`, яка заповнюється декларативно відповідним типом даних, при створені бізнес-логіки.

## BusinessLoader

Завантажувач бізнес-логіки призначений для створення абстрактної схеми функціоналу бізнес-логіки серверного застосунку. В послідуючому схема буде надана адаптеру конкретного фреймворка, наприклад `ExpressFrameworkAdapter`, `HapiFrameworkAdapter`, `FastifyFrameworkAdapter` чи ін. 

Конфігурація та вибір відповідного адаптеру фреймворка дивись [FrameworkFactory]()

<hr/>

### Склад схеми {docsify-ignore}

Схема бізнес-логіки логіки представляє собою `Map` колекцію, яка складається з наступним полів:

| Назва | Тип  | Підптип | Порядок | Опис |
| :---: | :--: | :-----: | :--: | :---- |
| routes | `Set` колекція | :-----: | :--: |

- `type SchemaStorage = Map<ApplicationName, Collection>`:
    - `SchemaStorage` - `Map` колекція результуючої бізнес-логіки.
    - `ApplicationName` - Тип - `string`. Обов'язковість так. Опис -  Унікальна назва серверного застосунку.
    - `Collection` - Об'єкт, який описує одну колекцію. Об'єкт колекції складається з наступних полів:
        - `routes` - `Set` колекція, яка складається з об'єктів `Route`, який складається з наступних полів:
            - `method` - Тип - `union type`. Обов'язковість - так. Визначає один із типів REST API методів: 
                - `get`
                - `post`
                - `patch`
                - `put`
                - `delete`
                - `options`
                - `head` 
            - `path` - Тип - `string`. Обов'язковість - так. Унікальний адрес машруту обробника запиту.
            - `preValidateHandler` - Тип - `function`. Обов'язковість - ні. Обробник валідації, який спрацьовує перед основним обробником запиту. Функція має вигляд: `(body: Record<string, unknown>) => ValidationResult`, де:
                - `body` - Тип `object`. Обов'язковість - так. Вхідний об'єкт даних послідуючої їх валідації.  
                - `ValidationResult` Тип - `object` або `null`. Обов'язковість - так. Якщо `body` відповідає схемі валідації, тоді повертає `null`, в іншому випадку повертає об'єкт `Result`, який є массивом, який складається з об'єктів:
                    - `message` -  Тип - `string`. Текст помилки валідації
                    - `key` - Тип - `string` або `undefined`. Якщо наявний ключ поля в об'єкті то надає назву ключа, інакше `undefined.
                    - `value` - Тип - `any`. Значення, яке було передано до відповідного ключа в об'єкті `body`.
            - `handler` - Тип - `function`. Обов'язковість - так. Основний обробник запиту. Функція має вигляд: 


#### SchemaStorage

Об'єкт `SchemaStorage` являє собою `Map` колекцію, яка складається з 2 аргументів:

| Назва | Тип  | Обов'язковість | Особливості | Опис |
| :---: | :--: | :------------: | :---------: | :--- |
| application | string | Так | - | Назва серверного застосунку |
| applicationStorage | [ApplicationStorage](#applicationstorage) | Так | - | Дані бізнес-логіки конкретного застосунку |


#### ApplicationStorage

| Назва | Тип  | Обов'язковість | Особливості | Опис |
| :---: | :--: | :------------: | :---------: | :--- |
| options | [Options](#options) | Так | - | Назва серверного застосунку |
| collection | [Collection](#collection) | Так | Повинна бути проініціалізована | `Map` колекція, яка складається з назви колекції бізнес-логіки та даних колекції бізнес-логіки |


#### Options


#### Collection

#### CollectionStorage

| Назва | Тип  | Обов'язковість | Особливості | Опис |
| :---: | :--: | :------------: | :---------: | :--- |
| routes | [Set<Routine>](#collection) | Так | Повинна бути проініціалізована | `Set` коллекція всіх машрутів конкретної колекції |
| localization | [Localization](#localization) | Так | Повинна бути проініалізована | `Map` колекція перекладів |
| entity | [Entity](#entity) | Ні | Схема сутності бази даних, яка описується для послідуючої інтеграції в `TypeORM` |

#### Route

| Назва | Тип  | Обов'язковість | Особливості | Опис |
| :---: | :--: | :------------: | :---------: | :--- |
| method | string | Так | Є union типом | Значення може бути тільки: `get` / `post` / `put` / `patch` / `delete` / `head` / `options` |
| path | string | Так | - | Унікальний адрес машруту, по якому може бути викликаний обробник |
| basicHandler | [BasicHandler](#) | Так | Основний обробник маршруту |
| preHandler | [PreHandler](#) | Ні | Обробник, який виконується перед основним обробником маршруту. Може виступати лише як валідатор вхідних даних |
| postHandler | [PostHandler](#) | Ні | Обробник, який виконується після основного обробника маршруту. Може виступати лише як валідатор вихідних даних |
| middlewares | [Array<Middleware>](#) | Ні | Масив проміжних обробників, який виконується після `PreHandler` обробника, в порядку їх влаштування та до виконання основного обробника |


#### Localization 

#### Entity





```typescript
export type Collection = {
  routes: Set<Routine>;
  localization: Map<string, Record<string, string>>;
  entity?: CollectionEntity;
};

```


## SwaggerLoader


## AsyncApiLoader