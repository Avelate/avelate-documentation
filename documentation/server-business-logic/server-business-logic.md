# sessions

> [!ATTENTION]
> **Стабільність**: 2 - Стабільний

Об'єкт сесій надає функціонал по роботі з сесіями користувачів.

<hr/>

## Структури даних

### Структура даних сесії

```typescript
type SessionStorage = {
    clientTag?: string
    serverTag?: string
}

```

### Структура даних кімнати

```typescript
type RoomStorage = {
    type: RoomType
    auth: AuthType
    sessions: Map<UUID, RoomSession>
    size?: number
    title: string
    description?: string
    link?: string
    image?: string
}

type RoomType = 'group' | 'channel'
type AuthType = 'public' | 'private'

type RoomSession = {
    role: string
    session: SessionStorage
}
```

### Структура даних з'єднання

## Зміст
- getters
    - [sessions.connectionSize](#sessionsconnectionsize)
    - [sessions.sessionsSize](#sessionssessionssize)
    - [sessions.roomSize](#sessionsroomsize)
- methods
    - [sessions.openSession](#sessionsopensession)
    - [sessions.getSessionInfo](#sessionsgetsessioninfo)
    - [sessions.closeSession](#sessionsclosesession)
    - [sessions.sentToSession](#sessionssendtosession)
    - [sessions.createRoom](#sessionscreateroom)
    - [sessions.createPersonalRoom](#sessionscreatepersonalroom)
    - [sessions.setSessionToPersonalRoom](#sessionscreatepersonalroom)
    - [sessions.setSessionToRoom](#sessionssetsessiontoroom)
    - [sessions.getSessionFromRoom](#sessionsgetsessionfromroom)
    - [sessions.getSessionsFromRoom](#sessionsgetsessionsfromroom)
    - [sessions.removeSessionFromRoom](#sessionsremovesessionfromroom)
    - [sessions.roomSessionCount](#sessionsroomsessioncount)
    - [sessions.destroyRoom](#sessionsdestroyroom)
    - [sessions.broadcastToRoom](#sessionsbroadcasttoroom)
    - [sessions.broadcastToApp](#sessionsbroadcasttoapp)
    - [sessions.broadcastToAll](#sessionsbroadcasttoall)

## sessions.openSession

> [!ATTENTION]
> **Стабільність**: 2 - Стабільний

Генерує унікальний ідентифікатор сесії. Відкриває авторизовану сесію користувача додаючи об'єкт з даними користувача до колекції сесії, ключом якого виступає згенерований унікальний ідентифікатор сесії.

### Параметри

| Параметр | Порядок |  Назва  |                        Тип                         | Обов'язковість | Деталі                                                                                    |
|:--------:|:-------:|:-------:|:--------------------------------------------------:|:--------------:|:------------------------------------------------------------------------------------------|
| Вхідний  |    1    | payload | Generic<T extends {user: Record<string, unknown>}> |      Так       | Об'єкт, який складається з ключа `user`, в якому знаходиться об'єкт  з даними користувача |
| Вихідний |    1    |    -    |                       string                       |      Так       | Унікальний ідентифікатор сесії                                                            |  

### Приклад

## sessions.getSessionInfo

Надає інформацію згідно з конкретною сесією.

### Параметри

| Параметр | Порядок |   Назва   |                        Тип                         | Обов'язковість | Деталі                                                                                            |
|:--------:|:-------:|:---------:|:--------------------------------------------------:|:--------------:|:--------------------------------------------------------------------------------------------------|
| Вхідний  |    1    | sessionId |                       string                       |      Так       | унікальний ідентифікатор сесії                                                                    |
| Вихідний |    1    |     -     | Generic<T extends {user: Record<string, unknown>}> |      Так       | Будь-який об'єкт, який складається з ключа user, в якому знаходиться об'єкт  з даними користувача |  

### Приклад

## sessions.closeSession

Закриває сесії користувача шляхом видалення її з колекції сесій.

### Параметри

| Параметр | Порядок |   Назва   |  Тип   | Обов'язковість | Деталі                         |
|:--------:|:-------:|:---------:|:------:|:--------------:|:-------------------------------|
| Вхідний  |    1    | sessionId | string |      Так       | унікальний ідентифікатор сесії |

### Приклад

## sessions.sendToSession

Відправляє подію від конкретної сесії до конкретної сесії.

### Параметри

| Параметр | Порядок |    Назва    |      Тип       | Обов'язковість | Деталі                                             |
|:--------:|:-------:|:-----------:|:--------------:|:--------------:|:---------------------------------------------------|
| Вхідний  |    1    |  sessionId  |     string     |      Так       | Унікальний ідентифікатор сесії відправника         |
| Вхідний  |    2    | recipientId |     string     |      Так       | Унікальний ідентифікатор сесії отримувача          |
| Вхідний  |    3    |    event    | CustomEvent<T> |      Так       | Подія, яку необхідно надіслати до конкретної сесії |

```typescript
type CustomEvent<T> = {
    event: string
    payload: T
}
```

### Приклад

## sessions.createRoom

Створює приватну кімнату для сесій.

### Параметри

| Параметр | Порядок | Назва |  Тип   | Обов'язковість | Деталі                           |
|:--------:|:-------:|:-----:|:------:|:--------------:|:---------------------------------|
| Вихідний |    1    |   -   | string |      Так       | Унікальний ідентифікатор кімнати |

### Приклад

## sessions.createPersonalRoom

Створює персональну кімнату. Персональна кімната може вміщати лише двох сесій.

### Параметри

| Параметр | Порядок | Назва |  Тип   | Обов'язковість | Деталі                           |
|:--------:|:-------:|:-----:|:------:|:--------------:|:---------------------------------|
| Вихідний |    1    |   -   | string |      Так       | Унікальний ідентифікатор кімнати |

## sessions.setSessionToPersonalRoom

Додає сесію до персональної кімнати. Якщо кімната вже має дві сесії - видасть помилку.

### Параметри

| Параметр | Порядок |   Назва   |                Тип                | Обов'язковість | Деталі                           |
|:--------:|:-------:|:---------:|:---------------------------------:|:--------------:|:---------------------------------|
| Вхідний  |    1    |  roomId   |              string               |      Так       | Унікальний ідентифікатор кімнати |
| Вхідний  |    2    | sessionId |              string               |      Так       | Унікальний ідентифікатор сесії   |
| Вхідний  |    3    |  roomId   | Generic<T extends SessionStorage> |      Так       | Об'єкт сесії користувача         |

### Приклад

## sessions.setSessionToRoom

Додає сесію до публічної кімнати. Якщо кімната вже має дві сесії - видасть помилку.

### Параметри

| Параметр | Порядок |   Назва   |                Тип                | Обов'язковість | Деталі                           |
|:--------:|:-------:|:---------:|:---------------------------------:|:--------------:|:---------------------------------|
| Вхідний  |    1    |  roomId   |              string               |      Так       | Унікальний ідентифікатор кімнати |
| Вхідний  |    2    | sessionId |              string               |      Так       | Унікальний ідентифікатор сесії   |
| Вхідний  |    3    |  session  | Generic<T extends SessionStorage> |      Так       | Об'єкт сесії користувача         |

### Приклад

## sessions.getSessionFromRoom

Отримати дані конкретної сесії з приватної або публічної кімнати.

### Параметри

| Параметр | Порядок |   Назва   |                Тип                | Обов'язковість | Деталі                           |
|:--------:|:-------:|:---------:|:---------------------------------:|:--------------:|:---------------------------------|
| Вхідний  |    1    |  roomId   |              string               |      Так       | Унікальний ідентифікатор кімнати |
| Вхідний  |    2    | sessionId |              string               |      Так       | Унікальний ідентифікатор сесії   |
| Вихідний |    1    |     -     | Generic<T extends SessionStorage> |      Так       | Об'єкт сесії користувача         |

## sessions.getSessionsFromRoom

Отримати всі сесії з приватної чи публічної кімнати.

### Параметри

| Параметр | Порядок |   Назва   |                   Тип                    | Обов'язковість | Деталі                           |
|:--------:|:-------:|:---------:|:----------------------------------------:|:--------------:|:---------------------------------|
| Вхідний  |    1    |  roomId   |                  string                  |      Так       | Унікальний ідентифікатор кімнати |
| Вхідний  |    2    | sessionId |                  string                  |      Так       | Унікальний ідентифікатор сесії   |
| Вихідний |    1    |     -     | Array<Generic<T extends SessionStorage>> |      Так       | Об'єкти сесії користувача        |

### Приклад

## sessions.removeSessionFromRoom

Видалити конкретну сесію з конкретної кімнати.

### Параметри

| Параметр | Порядок |   Назва   |  Тип   | Обов'язковість | Деталі                           |
|:--------:|:-------:|:---------:|:------:|:--------------:|:---------------------------------|
| Вхідний  |    1    |  roomId   | string |      Так       | Унікальний ідентифікатор кімнати |
| Вхідний  |    2    | sessionId | string |      Так       | Унікальний ідентифікатор сесії   |

### Приклад


## sessions.roomSessionCount

Отримати кількість сесій в кімнаті

### Параметри

| Параметр | Порядок | Назва  |  Тип   | Обов'язковість | Деталі                           |
|:--------:|:-------:|:------:|:------:|:--------------:|:---------------------------------|
| Вхідний  |    1    | roomId | string |      Так       | Унікальний ідентифікатор кімнати |
| Вихідний |    1    |   -    | number |      Так       | Кількість сесій в кімнаті        |

### Приклад

## sessions.destroyRoom

Видалити кімнату з усіма користувачами в ній.

### Параметри

| Параметр | Порядок | Назва  |  Тип   | Обов'язковість | Деталі                           |
|:--------:|:-------:|:------:|:------:|:--------------:|:---------------------------------|
| Вхідний  |    1    | roomId | string |      Так       | Унікальний ідентифікатор кімнати |

### Приклад

## sessions.broadcastToRoom

Транслювати подію в конкретній кімнаті.

### Параметри

| Параметр | Порядок |  Назва  |    Тип     | Обов'язковість | Деталі                           |
|:--------:|:-------:|:-------:|:----------:|:--------------:|:---------------------------------|
| Вхідний  |    1    | roomId  |   string   |      Так       | Унікальний ідентифікатор кімнати |
| Вхідний  |    2    | payload | Generic<T> |      Так       | Дані                             | 

### Приклад

## sessions.broadcastToApp

Транслювати подію для конкретного сервер застосунку.

### Параметри

| Параметр | Порядок |  Назва  |    Тип     | Обов'язковість | Деталі |
|:--------:|:-------:|:-------:|:----------:|:--------------:|:-------|
| Вхідний  |    1    | payload | Generic<T> |      Так       | Дані   | 

### Приклад

## sessions.broadcastToAll

Транслювати подію для конкретного сервера застосунку всіх сервер застосунків.

### Параметри

| Параметр | Порядок |  Назва  |    Тип     | Обов'язковість | Деталі |
|:--------:|:-------:|:-------:|:----------:|:--------------:|:-------|
| Вхідний  |    1    | payload | Generic<T> |      Так       | Дані   | 

### Приклад

## sessions.connectionSize

Отримати кількість всіх неавторизованих з'єднань.

### Параметри

| Параметр | Порядок | Назва |  Тип   | Обов'язковість | Деталі             |
|:--------:|:-------:|:-----:|:------:|:--------------:|:-------------------|
| Вихідний |    1    |   -   | number |      Так       | Кількість з'єднань | 

### Приклад

## sessions.sessionsSize

Отримати кількість всіх сесій користувачів.

### Параметри

| Параметр | Порядок | Назва |  Тип   | Обов'язковість | Деталі                       |
|:--------:|:-------:|:-----:|:------:|:--------------:|:-----------------------------|
| Вихідний |    1    |   -   | number |      Так       | Кількість сесій користувачів | 

### Приклад

## sessions.roomSize

Отримати кількість як приватних, так і публічних кімнат.

### Параметри

| Параметр | Порядок | Назва |  Тип   | Обов'язковість | Деталі                                  |
|:--------:|:-------:|:-----:|:------:|:--------------:|:----------------------------------------|
| Вихідний |    1    |   -   | number |      Так       | Кількість приватних та публічних кімнат | 

### Приклад

# Issue

- Реалізація ролей в публічних кімнатах.
- Реалізація функціонала розміру кімнати та її обмеження.
- Реалізація `Telegram` бота в кімнаті.

# logger

Об'єкт логгера призначений для логування різних типів логів.

<hr/>

> [!ATTENTION]
> **Стабільність**: 2 - Стабільний

## Зміст
- methods
    - [logger.error]
    - [logger.warn]
    - [logger.info]
    - [logger.http]
    - [logger.verbose]
    - [logger.debug]
    - [logger.db]
    - [logger.storage]

## logger.error

Створює лог з типом логуванням `error`.

> [!WARNING]
> Рекомендується використовувати в `catch` блоку - `try - catch - finally` та для логування виключень `exception handler`

### Параметри

| Параметр | Порядок | Назва | Тип | Обов'язковість | Деталі                                                             |
|:--------:|:-------:|:-----:|:---:|:--------------:|:-------------------------------------------------------------------|
| Вхідний  |    1    | error | any |      Так       | Помилки, які генерується в `catch` блоку - `try - catch - finally` |

### Приклад

## logger.warn

Створює лог з типом логування `warn`.

> [!WARNING]
> Рекомендується використовувати при підозрілих діях, чи для некоректних дій, які не підпадають під виключення або помилку.

### Параметри

| Параметр | Порядок |  Назва  |       Тип       | Обов'язковість | Деталі       |
|:--------:|:-------:|:-------:|:---------------:|:--------------:|:-------------|
| Вхідний  |    1    | message | string / object |      Так       | Попередження |

### Приклад

## logger.info

Створює лог з типом логування `info`.

> [!WARNING]
> Рекомендується використовувати при фіксації будь-яких проміжних дій, які не стосуються `http` запитів, запитів в базу даних чи `memory` сховище.

### Параметри

| Параметр | Порядок |  Назва  |       Тип       | Обов'язковість | Деталі       |
|:--------:|:-------:|:-------:|:---------------:|:--------------:|:-------------|
| Вхідний  |    1    | message | string / object |      Так       | Попередження |

### Приклад


## logger.http

Створює лог з типом логування `http`.

> [!WARNING]
> Рекомендується використовувати при здійсненні `http` запитів.

### Параметри

| Параметр | Порядок | Назва  |    Тип     | Обов'язковість | Деталі                                   |
|:--------:|:-------:|:------:|:----------:|:--------------:|:-----------------------------------------|
| Вхідний  |    1    | router |   string   |      Так       | Назва маршрутизатора конкретної колекції |
| Вхідний  |    2    | method | union type |      Так       | Назва `http` методу                      |
| Вхідний  |    3    |  path  |   string   |      Так       | Адрес запиту                             |

### Приклад

## logger.verbose

Створює лог з типом логування `verbose`.

> [!WARNING]
> Рекомендується використовувати для створення логів з деталями.

### Параметри

| Параметр | Порядок |  Назва  |       Тип       | Обов'язковість | Деталі                    |
|:--------:|:-------:|:-------:|:---------------:|:--------------:|:--------------------------|
| Вхідний  |    1    | message | string / object |      Так       | Запис з усіма подробицями |

### Приклад



## logger.debug

Створює лог з типом логування `debug`.

> [!WARNING]
> Рекомендується використовувати в `debug` режимі під час розробки бізнес-логіки.

### Параметри

| Параметр | Порядок |  Назва  |                Тип                 | Обов'язковість | Деталі       |
|:--------:|:-------:|:-------:|:----------------------------------:|:--------------:|:-------------|
| Вхідний  |    1    | message | string / number / boolean / object |      Так       | Попередження |

### Приклад


## logger.db


Створює лог з типом логування `db`.

> [!WARNING]
> Рекомендується використовувати під час запитів до бази даних, до якого включати сам запит.

### Параметри

| Параметр | Порядок |  Назва  |       Тип       | Обов'язковість | Деталі              |
|:--------:|:-------:|:-------:|:---------------:|:--------------:|:--------------------|
| Вхідний  |    1    | message | string / object |      Так       | Запит до бази даних |

### Приклад


## logger.storage

Створює лог з типом логування `storage`.

> [!WARNING]
> Рекомендується використовувати під час запиту до `memory` сховища, наприклад при зверненнях до методів `CacheService`.

### Параметри

| Параметр | Порядок |  Назва  |       Тип       | Обов'язковість | Деталі                    |
|:--------:|:-------:|:-------:|:---------------:|:--------------:|:--------------------------|
| Вхідний  |    1    | message | string / object |      Так       | Запит до `memory` сховища |

### Приклад


# i10n

Об'єкт i10n призначений для створення локалізацій відповідей від сервера до джерел взаємодії.

<hr/>

> [!ATTENTION]
> **Стабільність**: 2 - Стабільний

## Зміст
- methods:
    - [i10n.t](#i10nt)
    - [i10n.changeLanguage](#i10nchangelanguage)
    - [i10n.checkLanguage](#i10nchecklanguage)
- getters:
    - [i10n.supportLanguages](#i10nsupportlanguages)

## i10n.t

Надає значення в потрібній мові, яка зазначена для сесії користувача. Якщо значення - фраза має динамічні поля огорнуті в фігурні дужки, то їх необхідно передати в формі об'єкта:
- ключ - ключ динамічного поля.
- значення - значення динамічного поля.


### Параметри

| Параметр | Порядок | Назва  |           Тип           | Обов'язковість | Деталі                                  |
|:--------:|:-------:|:------:|:-----------------------:|:--------------:|:----------------------------------------|
| Вхідний  |    1    |  key   |         string          |      Так       | Назва ключа фрази в потрібній мові      |
| Вхідний  |    2    | nested | Record<string, unknown> |       Ні       | Динамічні поля огорнуті в фігурні дужки |
| Вихідний |    1    |   -    |         string          |      Так       | Фраза в потрібній мові                  |


### Приклад


## i10n.changeLanguage

Змінює нинішню мову у користувача для послідуючого відправлення фрази вже новою мовою. Якщо мова не підтримується сервером, то буде створене виключення.

### Параметри

| Параметр | Порядок |  Назва   |  Тип   | Обов'язковість | Деталі     |
|:--------:|:-------:|:--------:|:------:|:--------------:|:-----------|
| Вхідний  |    1    | language | string |      Так       | Назва мови |

### Приклад

## i10n.checkLanguage

Перевіряє дійсну мову у сесії користувача з введенною при запиті.

### Параметри

| Параметр | Порядок |  Назва   |   Тип   | Обов'язковість | Деталі                                        |
|:--------:|:-------:|:--------:|:-------:|:--------------:|:----------------------------------------------|
| Вхідний  |    1    | language | string  |      Так       | Назва мови                                    |
| Вихідний |    1    |    -     | boolean |      Так       | Підтвердження чи спростування різниці в мовах |

### Приклад

## i10n.supportLanguages

Надає список всіх мов, які підтримуються сервером.

### Параметри

| Параметр | Порядок | Назва |      Тип      | Обов'язковість | Деталі                                       |
|:--------:|:-------:|:-----:|:-------------:|:--------------:|:---------------------------------------------|
| Вихідний |    1    |   -   | Array<string> |      Так       | Перелік всіх мов, які підтримуються сервером |

### Приклад

# db

Об'єкт db призначений для доступу до репозиторіїв баз даних

<hr/>

> [!ATTENTION]
> **Стабільність**: 2 - Стабільний

## Зміст
- methods:
    - [db.getRepo](#dbgetrepo)


## db.getRepo

Надає репозиторій згідно з назвою сутності `schema-entity` відповідної колекції.

### Параметри

| Параметр | Порядок | Назва |      Тип      | Обов'язковість | Деталі                                                                                |
|:--------:|:-------:|:-----:|:-------------:|:--------------:|:--------------------------------------------------------------------------------------|
| Вхідний  |    1    | name  |    string     |      Так       | Назва схеми сутності таблиці в базі даних `schema-entity`                             |
| Вихідний |    1    |   -   | Repository<T> |      Так       | Репозиторій згідно сутності `schema-entity`, який має тип об'єкту указаний в типі <T> |

### Приклад

# mail

Об'єкт `mail` призначений для надсилання електронної пошти.

<hr/>

> [!ATTENTION]
> **Стабільність**: 2 - Стабільний

## Зміст
- methods:
  [mail.sendActivationLink]()
  [mail.sendMessage]()

## mail.sendActivationLink

Надсилає поштове повідомлення на вказану пошту. Пошта відправника може бути вказана:
- В системній таблиці системних опцій `SYS_ADMIN_SYSTEM_OPTIONS`
- В змінній оточення, яка вичитується з конфігураційного файлу.

> [!WARNING]
> Рекомендується використовувати системну таблицю `SYS_ADMIN_SYSTEM_OPTIONS`, тому що пошта відправника може бути змінена, і кращим варіантом є, якщо вона буде змінена на рівні даних бізнес-логіки, а не на рівні системних даних.

### Параметри

| Параметр | Порядок | Назва |  Тип   | Обов'язковість | Деталі            |
|:--------:|:-------:|:-----:|:------:|:--------------:|:------------------|
| Вхідний  |    1    |  url  | string |      Так       | Адрес запиту      |
| Вхідний  |    2    | token | string |      Так       | Токен верифікації |

### Приклад

## mail.sendMessage

Надсилає поштове повідомлення на вказану пошту. Пошта відправника може бути вказана:
- В системній таблиці системних опцій `SYS_ADMIN_SYSTEM_OPTIONS`
- В змінній оточення, яка вичитується з конфігураційного файлу.

> [!WARNING]
> Рекомендується використовувати системну таблицю `SYS_ADMIN_SYSTEM_OPTIONS`, тому що пошта відправника може бути змінена, і кращим варіантом є, якщо вона буде змінена на рівні даних бізнес-логіки, а не на рівні системних даних.

### Параметри

| Параметр | Порядок |  Назва  |  Тип   | Обов'язковість | Деталі                                  |
|:--------:|:-------:|:-------:|:------:|:--------------:|:----------------------------------------|
| Вхідний  |    1    |   to    | string |      Так       | Пошта отримувача                        |
| Вхідний  |    2    | subject | string |      Так       | Заголовок електронного листа            |
| Вхідний  |    3    |  text   | string |      Так       | Текст електронного листа                |
| Вхідний  |    4    |  html   | string |       Ні       | HTML розмітка тексту електронного листа |

### Приклад


